<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - Add Friend</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 72px;
            background: #0f0f0f;
            border-right: 1px solid #2c2f33;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            overflow-y: auto;
        }

        .sidebar-item {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7289da, #43b581);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar-item:hover {
            border-radius: 30%;
            transform: scale(1.1);
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #7289da, #5865f2);
            box-shadow: 0 0 10px rgba(114, 137, 218, 0.5);
        }

        .sidebar-item img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .sidebar-item span {
            font-size: 24px;
        }

        /* Status indicator */
        .status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #43b581;
            border: 2px solid #0f0f0f;
        }

        /* Friends Panel */
        .friends-panel {
            width: 360px;
            background: #1a1a1a;
            border-right: 1px solid #2c2f33;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .friends-header {
            padding: 16px;
            border-bottom: 1px solid #2c2f33;
        }

        .friends-header h2 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 12px;
            color: #b9bbbe;
        }

        .search-bar {
            width: 100%;
            padding: 8px 12px;
            background: #2c2f33;
            border: none;
            border-radius: 20px;
            color: #ffffff;
            font-size: 14px;
        }

        .search-bar::placeholder {
            color: #72767d;
        }

        .tabs {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            border-bottom: 1px solid #2c2f33;
            background: #15171b;
        }

        .tab {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: #b9bbbe;
            font-size: 13px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .tab.active {
            background: #5865f2;
            color: #ffffff;
        }

        .tab:hover {
            color: #ffffff;
        }

        .panel-status {
            padding: 8px 16px;
            font-size: 12px;
            color: #b9bbbe;
            border-bottom: 1px solid #2c2f33;
            display: none;
        }
        
        .panel-status.success {
            color: #43b581;
        }
        
        .panel-status.error {
            color: #f04747;
        }

        .friends-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0;
        }

        .friend-item {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .friend-item:hover {
            background: #2c2f33;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7289da, #5865f2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
        }

        .friend-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .friend-info {
            flex: 1;
            min-width: 0;
        }

        .friend-name {
            font-size: 14px;
            font-weight: 500;
            color: #ffffff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .friend-status {
            font-size: 12px;
            color: #72767d;
            margin-top: 2px;
        }

        .empty-state {
            padding: 24px;
            text-align: center;
            color: #72767d;
            font-size: 14px;
        }

        .pending-section-title {
            padding: 8px 16px;
            font-size: 12px;
            text-transform: uppercase;
            color: #b9bbbe;
            letter-spacing: 0.5px;
        }

        .pending-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .pending-btn {
            flex: 1;
            padding: 6px 8px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .pending-btn.accept {
            background: #2fba85;
            color: #0f0f0f;
        }

        .pending-btn.accept:hover {
            background: #28a173;
        }

        .pending-btn.decline {
            background: #2c2f33;
            color: #f04747;
        }

        .pending-btn.decline:hover {
            background: #3a3d42;
        }

        .add-friend-btn {
            padding: 12px 16px;
            background: #5865f2;
            border: none;
            color: #ffffff;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            margin: 16px;
            transition: all 0.2s ease;
        }

        .add-friend-btn:hover {
            background: #4752c4;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0f0f0f;
        }

        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid #2c2f33;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .chat-header-icons {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: #b9bbbe;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: #2c2f33;
            color: #ffffff;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7289da, #43b581);
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .message-author {
            font-weight: 600;
            font-size: 14px;
            color: #ffffff;
        }

        .message-time {
            font-size: 12px;
            color: #72767d;
        }

        .message-text {
            font-size: 14px;
            color: #d1d5db;
            line-height: 1.5;
        }

        /* Input Area */
        .input-area {
            padding: 24px;
            display: flex;
            gap: 12px;
        }

        .input-box {
            flex: 1;
            background: #2c2f33;
            border: none;
            border-radius: 20px;
            padding: 12px 16px;
            color: #ffffff;
            font-size: 14px;
        }

        .input-box::placeholder {
            color: #72767d;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #5865f2;
            border: none;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .send-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .send-btn:not(:disabled):hover {
            background: #4752c4;
        }

        /* Add Friend Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1a1a1a;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.9);
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #ffffff;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: #b9bbbe;
        }

        .form-input {
            background: #2c2f33;
            border: 1px solid #2c2f33;
            border-radius: 4px;
            padding: 10px 12px;
            color: #ffffff;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #5865f2;
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.1);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #5865f2;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #4752c4;
        }

        .btn-secondary {
            background: #2c2f33;
            color: #b9bbbe;
        }

        .btn-secondary:hover {
            background: #3a3d42;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #2c2f33;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3a3d42;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-item active">
                <span>üí¨</span>
            </div>
            <div class="sidebar-item">
                <span>üë•</span>
            </div>
            <div class="sidebar-item">
                <span>üéÆ</span>
            </div>
            <div class="sidebar-item">
                <span>‚öôÔ∏è</span>
            </div>
        </div>

        <!-- Friends Panel -->
        <div class="friends-panel">
            <div class="friends-header">
                <h2> Friends</h2>
                <input type="text" class="search-bar" placeholder="Search...">
            </div>

            <div class="tabs">
                <button class="tab active" data-view="friends">Friends</button>
                <button class="tab" data-view="pending">Pending</button>
            </div>

            <div class="panel-status" id="panelStatus"></div>

            <div class="friends-list" id="friendsList">
                <div class="empty-state">ƒêang t·∫£i danh s√°ch b·∫°n b√®...</div>
            </div>

            <button class="add-friend-btn">+ Add Friend</button>
        </div>

        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-header-title" id="chatHeaderTitle">Ch∆∞a ch·ªçn b·∫°n b√®</div>
                <div class="chat-header-icons">
                    <button class="icon-btn" title="Th√¥ng tin cu·ªôc tr√≤ chuy·ªán">‚ÑπÔ∏è</button>
                </div>
            </div>

            <div class="messages" id="messagesContainer">
                <div class="empty-state">Ch·ªçn m·ªôt ng∆∞·ªùi b·∫°n ·ªü danh s√°ch b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu tr√≤ chuy·ªán.</div>
            </div>

            <div class="input-area">
                <input type="text" class="input-box" id="messageInput" placeholder="H√£y ch·ªçn m·ªôt ng∆∞·ªùi b·∫°n ƒë·ªÉ nh·∫Øn tin" disabled>
                <button class="send-btn" id="sendButton" disabled>‚û§</button>
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div class="modal-overlay" id="addFriendModal">
        <div class="modal">
            <div class="modal-header">Add Friend</div>
            <form class="modal-form">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="friendUsername" placeholder="Nh·∫≠p username ng∆∞·ªùi b·∫°n mu·ªën k·∫øt n·ªëi">
                </div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-input" id="friendMessage" rows="4" placeholder="L·ªùi nh·∫Øn (tu·ª≥ ch·ªçn)"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Send Request</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        (function () {
            const CONTEXT_PATH = window.location.pathname.startsWith('/megachat') ? '/megachat' : '';
            const API_BASE = `${CONTEXT_PATH}/api`;

            const savedUser = localStorage.getItem('user');
            if (!savedUser) {
                window.location.href = `${CONTEXT_PATH}/login.html`;
                return;
            }
            const currentUser = JSON.parse(savedUser);

            const modal = document.getElementById('addFriendModal');
            const addFriendBtns = document.querySelectorAll('.add-friend-btn');
            const cancelBtn = document.querySelector('.btn-secondary');
            const modalForm = document.querySelector('.modal-form');
            const usernameInput = document.getElementById('friendUsername');
            const messageInputModal = document.getElementById('friendMessage');

            const tabs = document.querySelectorAll('.tab');
            const friendsList = document.getElementById('friendsList');
            const panelStatus = document.getElementById('panelStatus');
            const chatHeaderTitle = document.getElementById('chatHeaderTitle');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');

            const state = {
                currentView: 'friends',
                friends: [],
                incoming: [],
                outgoing: [],
                selectedFriend: null,
                currentUser: currentUser,
            };

            function setStatus(message, type = 'info') {
                if (!message) {
                    panelStatus.style.display = 'none';
                    panelStatus.textContent = '';
                    panelStatus.className = 'panel-status';
                    return;
                }
                panelStatus.style.display = 'block';
                panelStatus.textContent = message;
                panelStatus.className = `panel-status ${type}`;
            }

            async function apiRequest(path, options = {}) {
                const opts = {
                    method: 'GET',
                    credentials: 'include',
                    headers: {},
                    ...options,
                };

                if (opts.body && typeof opts.body !== 'string') {
                    opts.headers['Content-Type'] = 'application/json';
                    opts.body = JSON.stringify(opts.body);
                }

                const response = await fetch(`${API_BASE}${path}`, opts);
                let data = {};
                try {
                    data = await response.json();
                } catch (error) {
                    // ignore
                }

                if (!response.ok || data.success === false) {
                    const message = data && data.message ? data.message : 'C√≥ l·ªói x·∫£y ra';
                    throw new Error(message);
                }

                return data;
            }

            function renderFriends() {
                friendsList.innerHTML = '';
                if (!state.friends.length) {
                    friendsList.innerHTML = '<div class="empty-state">B·∫°n ch∆∞a c√≥ b·∫°n b√® n√†o. H√£y g·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu tr√≤ chuy·ªán!</div>';
                    updateChatSelection(null);
                    return;
                }

                state.friends.forEach(friend => {
                    const item = document.createElement('div');
                    item.className = 'friend-item';
                    item.dataset.friendId = friend.id;

                    item.innerHTML = `
                        <div class="friend-avatar">
                            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 16px;">
                                ${friend.username.charAt(0).toUpperCase()}
                            </div>
                            <div class="status-dot"></div>
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.username}</div>
                            <div class="friend-status">${friend.email || 'B·∫°n b√®'}</div>
                        </div>
                    `;

                    item.addEventListener('click', () => {
                        updateChatSelection(friend);
                    });

                    if (state.selectedFriend && state.selectedFriend.id === friend.id) {
                        item.style.background = '#2c2f33';
                    }

                    friendsList.appendChild(item);
                });

                if (!state.selectedFriend) {
                    updateChatSelection(state.friends[0]);
                }
            }

            function renderPending() {
                friendsList.innerHTML = '';

                if (!state.incoming.length && !state.outgoing.length) {
                    friendsList.innerHTML = '<div class="empty-state">Ch∆∞a c√≥ l·ªùi m·ªùi k·∫øt b·∫°n n√†o.</div>';
                    return;
                }

                if (state.incoming.length) {
                    const incomingTitle = document.createElement('div');
                    incomingTitle.className = 'pending-section-title';
                    incomingTitle.textContent = 'L·ªùi m·ªùi ƒë·∫øn';
                    friendsList.appendChild(incomingTitle);

                    state.incoming.forEach(request => {
                        friendsList.appendChild(createPendingItem(request));
                    });
                }

                if (state.outgoing.length) {
                    const outgoingTitle = document.createElement('div');
                    outgoingTitle.className = 'pending-section-title';
                    outgoingTitle.textContent = 'L·ªùi m·ªùi ƒë√£ g·ª≠i';
                    friendsList.appendChild(outgoingTitle);

                    state.outgoing.forEach(request => {
                        friendsList.appendChild(createPendingItem(request));
                    });
                }
            }

            function createPendingItem(request) {
                const item = document.createElement('div');
                item.className = 'friend-item';

                const currentId = state.currentUser ? Number(state.currentUser.id) : null;
                const receiverId = request.receiver ? Number(request.receiver.id) : null;
                const requesterId = request.requester ? Number(request.requester.id) : null;

                const isCurrentUserReceiver = currentId !== null && receiverId === currentId;
                const isCurrentUserRequester = currentId !== null && requesterId === currentId;

                const otherUser = isCurrentUserReceiver ? request.requester : request.receiver;
                const otherName = otherUser && otherUser.username ? otherUser.username : 'Ng∆∞·ªùi d√πng';
                const otherInitial = otherName.charAt(0).toUpperCase();

                const statusText = isCurrentUserReceiver
                    ? 'ƒêang ch·ªù b·∫°n ph·∫£n h·ªìi'
                    : 'ƒêang ch·ªù ƒë·ªëi ph∆∞∆°ng';

                item.innerHTML = `
                    <div class="friend-avatar">
                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 16px;">
                            ${otherInitial}
                        </div>
                    </div>
                    <div class="friend-info">
                        <div class="friend-name">${otherName}</div>
                        <div class="friend-status">${request.message || statusText}</div>
                        ${isCurrentUserReceiver ? `
                            <div class="pending-actions">
                                <button class="pending-btn accept" data-action="accept" data-id="${request.id}">ƒê·ªìng √Ω</button>
                                <button class="pending-btn decline" data-action="decline" data-id="${request.id}">T·ª´ ch·ªëi</button>
                            </div>
                        ` : ''}
                    </div>
                `;

                if (isCurrentUserReceiver) {
                    item.querySelectorAll('.pending-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            respondRequest(btn.dataset.id, btn.dataset.action);
                        });
                    });
                }

                return item;
            }

            function updateChatSelection(friend) {
                state.selectedFriend = friend;
                if (!friend) {
                    chatHeaderTitle.textContent = 'Ch∆∞a ch·ªçn b·∫°n b√®';
                    messageInput.value = '';
                    messageInput.placeholder = 'H√£y ch·ªçn m·ªôt ng∆∞·ªùi b·∫°n ƒë·ªÉ nh·∫Øn tin';
                    messageInput.disabled = true;
                    sendButton.disabled = true;
                    return;
                }

                chatHeaderTitle.textContent = friend.username;
                messageInput.placeholder = `Nh·∫Øn tin cho @${friend.username}`;
                messageInput.disabled = false;
                sendButton.disabled = false;

                // Highlight selected friend
                document.querySelectorAll('.friend-item').forEach(item => {
                    if (item.dataset.friendId && Number(item.dataset.friendId) === friend.id) {
                        item.style.background = '#2c2f33';
                    } else {
                        item.style.background = 'transparent';
                    }
                });
            }

            function renderCurrentView() {
                if (state.currentView === 'friends') {
                    renderFriends();
                } else {
                    renderPending();
                }
            }

            async function loadFriends() {
                const showStatus = state.currentView === 'friends';
                try {
                    if (showStatus) {
                        setStatus('ƒêang t·∫£i danh s√°ch b·∫°n b√®...');
                    }
                    const data = await apiRequest('/friends');
                    state.friends = data.friends || [];
                    if (showStatus) {
                        setStatus('');
                    }
                    if (state.currentView === 'friends') {
                        renderFriends();
                    }
                } catch (error) {
                    if (showStatus) {
                        setStatus(error.message, 'error');
                    }
                    if (state.currentView === 'friends') {
                        friendsList.innerHTML = `<div class="empty-state">${error.message}</div>`;
                    }
                }
            }

            async function loadRequests() {
                try {
                    const data = await apiRequest('/friends/requests');
                    state.incoming = data.incoming || [];
                    state.outgoing = data.outgoing || [];
                    if (state.currentView === 'pending') {
                        renderPending();
                    }
                } catch (error) {
                    if (state.currentView === 'pending') {
                        friendsList.innerHTML = `<div class="empty-state">${error.message}</div>`;
                    }
                }
            }

            async function respondRequest(id, action) {
                const endpoint = `/friends/requests/${id}/${action}`;
                try {
                    setStatus('ƒêang c·∫≠p nh·∫≠t l·ªùi m·ªùi...');
                    await apiRequest(endpoint, { method: 'POST' });
                    await Promise.all([loadFriends(), loadRequests()]);
                    setStatus('ƒê√£ c·∫≠p nh·∫≠t l·ªùi m·ªùi', 'success');
                } catch (error) {
                    setStatus(error.message, 'error');
                }
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    state.currentView = tab.dataset.view;
                    renderCurrentView();
                });
            });

            addFriendBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modal.classList.add('active');
                    usernameInput.focus();
                });
            });

            cancelBtn.addEventListener('click', (e) => {
                e.preventDefault();
                modal.classList.remove('active');
                modalForm.reset();
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    modalForm.reset();
                }
            });

            modalForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = usernameInput.value.trim();
                const note = messageInputModal.value.trim();

                if (!username) {
                    setStatus('Vui l√≤ng nh·∫≠p username c·∫ßn k·∫øt b·∫°n', 'error');
                    return;
                }

                try {
                    setStatus('ƒêang g·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n...');
                    await apiRequest('/friends/requests', {
                        method: 'POST',
                        body: {
                            targetUsername: username,
                            message: note || null,
                        },
                    });
                    setStatus('ƒê√£ g·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n', 'success');
                    modal.classList.remove('active');
                    modalForm.reset();
                    await Promise.all([loadFriends(), loadRequests()]);
                } catch (error) {
                    setStatus(error.message, 'error');
                }
            });

            sendButton.addEventListener('click', () => {
                if (!state.selectedFriend) return;
                const text = messageInput.value.trim();
                if (!text) {
                    setStatus('N·ªôi dung tin nh·∫Øn kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng', 'error');
                    return;
                }
                setStatus('Ch·ª©c nƒÉng chat realtime s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t sau', 'info');
                messageInput.value = '';
            });

            messageInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    sendButton.click();
                }
            });

            loadFriends();
            loadRequests();
        })();
    </script>
</body>
</html>